<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>Batterie 0%</title>


<!-- iOS full screen -->
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<link rel="apple-touch-icon" href="/icons/icon-192.png">


<!-- PWA manifest -->
<link rel="manifest" href="/manifest.webmanifest">
<meta name="theme-color" content="#000000">


<style>
:root{ --bg:#000; --outline:#fff; --low:#ff3b30; --size: min(54vmin, 68vw); }
*{box-sizing:border-box}
html,body{height:100%; margin:0; background:var(--bg); color:#fff}
body{display:grid; place-items:center; -webkit-tap-highlight-color:transparent; overscroll-behavior:none; user-select:none;}
.screen{position:relative; width:100%; height:100%; display:grid; place-items:center; padding: env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left);}


/* Batterie */
.battery{position:relative; width:var(--size); height:calc(var(--size)*0.45); border:6px solid var(--outline); border-radius:14px; display:grid; place-items:center; padding:10px 14px; transform:translateZ(0)}
.battery::after{content:""; position:absolute; right:-24px; top:50%; transform:translateY(-50%); width:18px; height:36%; border:6px solid var(--outline); border-left:none; border-radius:0 10px 10px 0}
.level-wrap{position:absolute; inset:10px 14px; display:flex; align-items:center}
.level{height:100%; width:6%; max-width:22px; background:var(--low); border-radius:8px}
.pct{position:absolute; inset:0; display:grid; place-items:center; font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Helvetica,Arial,sans-serif; font-weight:800; letter-spacing:.5px; font-size:calc(var(--size)*0.14); color:#fff}
.pct, .level { animation: warn 1s steps(1,end) infinite }
@keyframes warn { 0%,70%{opacity:1} 85%{opacity:.55} 100%{opacity:1} }
.blackout .battery{opacity:0}
.blackout *{animation:none!important}


/* tiny install banner (Android) */
#installBanner{position:fixed; left:50%; bottom:16px; transform:translateX(-50%); background:#111; color:#fff; padding:10px 14px; border-radius:12px; font-size:14px; display:none}
#installBanner button{margin-left:10px; background:#fff; color:#000; border:0; padding:6px 10px; border-radius:8px}
</style>
</head>
<body>
<div class="screen">
<div class="battery" id="battery">
<div class="level-wrap"><div class="level"></div></div>
<div class="pct">0%</div>
</div>
</div>


<div id="installBanner" role="dialog" aria-live="polite">Installer l’app ?<button id="installBtn" aria-label="Installer">Installer</button></div>


<script>
// Blackout after 5s
setTimeout(()=>{ document.body.classList.add('blackout'); }, 5000);


// Prevent double-tap zoom on iPhone
let lastTouch=0; document.addEventListener('touchend', e=>{ const now=Date.now(); if(now-lastTouch<300){ e.preventDefault(); } lastTouch=now; }, {passive:false});


// Register Service Worker (needed for Android install prompt)
if('serviceWorker' in navigator){
navigator.serviceWorker.register('/sw.js').catch(()=>{});
}


// Hide install UI if already installed (Android/desktop Chrome)
const isStandalone = window.matchMedia('(display-mode: standalone)').matches || window.navigator.standalone;
const banner = document.getElementById('installBanner');
const btn = document.getElementById('installBtn');
if(isStandalone){ banner.style.display='none'; }


// Minimal Add to Home Screen flow for Android/desktop Chrome
let deferredPrompt = null;
window.addEventListener('beforeinstallprompt', (e)=>{
// Show custom UI instead of the mini-infobar
e.preventDefault();
deferredPrompt = e;
banner.style.display = 'block';
});


btn?.addEventListener('click', async()=>{
if(!deferredPrompt) return;
banner.style.display='none';
try{
await deferredPrompt.prompt();
await deferredPrompt.userChoice; // result.outcome === 'accepted' | 'dismissed'
}catch{} finally{
deferredPrompt = null;
}
});


// Optional: hide banner once installed
window.addEventListener('appinstalled', ()=>{ banner.style.display='none'; });


// iOS: user installs via Partager > Ajouter à l’écran d’accueil (pas de prompt disponible)
</script>
</body>
</html>
